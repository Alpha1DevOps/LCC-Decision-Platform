<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCC DSS - Standalone Preview</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Recharts -->
    <!-- Prop Types (Required for some Recharts UMD builds) -->
    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
    <!-- Recharts (Fixed Version) -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            /* Slate-50 */
            background-image:
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.05) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.05) 0px, transparent 50%);
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .glass-header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        // -------------------------------------------------------------
        // ICONS (Raw SVG to avoid dependency issues in standalone)
        // -------------------------------------------------------------
        const Icons = {
            Settings: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></svg>,
            Plus: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14" /><path d="M12 5v14" /></svg>,
            Trash2: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></svg>,
            Trophy: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></svg>,
            Play: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3" /></svg>,
            Info: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="16" y2="12" /><line x1="12" x2="12.01" y1="8" y2="8" /></svg>,
            FileText: ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" x2="8" y1="13" y2="13" /><line x1="16" x2="8" y1="17" y2="17" /><polyline points="10 9 9 9 8 9" /></svg>,
        };

        // -------------------------------------------------------------
        // UTILS
        // -------------------------------------------------------------
        const cn = (...inputs) => inputs.filter(Boolean).join(' ');

        const calculateFutureCost = (cost, inflationRate, year) => {
            return cost * Math.pow(1 + inflationRate / 100, year);
        };

        const calculatePV = (futureCost, discountRate, year) => {
            return futureCost / Math.pow(1 + discountRate / 100, year);
        };

        const getCostForYear = (item, year) => {
            if (year === 0) return 0;
            if (item.frequency === 'yearly') return item.value;
            if (item.frequency === 'one-time') return item.year === year ? item.value : 0;
            if (item.frequency === 'every-n-years') return (item.interval && year % item.interval === 0) ? item.value : 0;
            return 0;
        };

        const analyzeOption = (option, config) => {
            const { lifespan, inflationRate, discountRate } = config;
            const cashFlows = [];
            let totalNPV = 0;

            let cumulativeNPV = option.initialCost;
            cashFlows.push({ year: 0, cost: option.initialCost, discountedCost: option.initialCost, cumulativeNPV });
            totalNPV += option.initialCost;

            for (let year = 1; year <= lifespan; year++) {
                let yearlyCostRaw = 0;
                option.maintenanceCosts.forEach(item => { yearlyCostRaw += getCostForYear(item, year); });
                option.operationCosts.forEach(item => { yearlyCostRaw += getCostForYear(item, year); });

                const futureCost = calculateFutureCost(yearlyCostRaw, inflationRate, year);
                let finalYearAdjustment = 0;
                if (year === lifespan) {
                    const demolish = calculateFutureCost(option.demolishCost, inflationRate, year);
                    const salvage = calculateFutureCost(option.salvageValue, inflationRate, year);
                    finalYearAdjustment = demolish - salvage;
                }

                const totalYearCost = futureCost + finalYearAdjustment;
                const pv = calculatePV(totalYearCost, discountRate, year);
                totalNPV += pv;
                cumulativeNPV += pv;

                cashFlows.push({ year, cost: totalYearCost, discountedCost: pv, cumulativeNPV });
            }

            const r = discountRate / 100;
            const n = lifespan;
            let eac = r === 0 ? totalNPV / n : (totalNPV * r) / (1 - Math.pow(1 + r, -n));

            return { optionId: option.id, totalNPV, eac, cashFlows };
        };

        const analyzeAll = (options, config) => options.map(opt => analyzeOption(opt, config));

        // -------------------------------------------------------------
        // CONTEXT
        // -------------------------------------------------------------
        const { createContext, useContext, useState, useEffect } = React;
        const LCCContext = createContext();

        const LCCProvider = ({ children }) => {
            const [options, setOptions] = useState([
                {
                    id: '1', name: 'Option 1 (Repair)', description: 'Basic repair of the existing asset to extend its life.', initialCost: 0,
                    maintenanceCosts: [{ id: 'm1', name: 'Annual Repair', value: 5000, frequency: 'yearly' }],
                    operationCosts: [], demolishCost: 0, salvageValue: 0,
                },
                {
                    id: '2', name: 'Option 2 (Replace Brand A)', description: 'Replacement with Brand A. Standard efficiency.', initialCost: 100000,
                    maintenanceCosts: [{ id: 'm2', name: 'Service', value: 2000, frequency: 'yearly' }],
                    operationCosts: [], demolishCost: 0, salvageValue: 10000,
                },
                {
                    id: '3', name: 'Option 3 (Replace Brand B)', description: 'Premium replacement (Brand B). Higher efficiency and residual value.', initialCost: 150000,
                    maintenanceCosts: [{ id: 'm3', name: 'Service', value: 1000, frequency: 'yearly' }],
                    operationCosts: [], demolishCost: 0, salvageValue: 20000,
                },
            ]);

            const [config, setConfig] = useState({ lifespan: 10, inflationRate: 3, discountRate: 5 });
            const [projectInfo, setProjectInfo] = useState({
                name: 'New LCC Analysis',
                description: '',
                analyst: '',
                date: new Date().toISOString().split('T')[0]
            });
            const [results, setResults] = useState([]);

            const addOption = () => {
                const newId = (Math.max(...options.map(o => parseInt(o.id) || 0)) + 1).toString();
                setOptions([...options, {
                    id: newId, name: `Option ${newId}`, description: '', initialCost: 0,
                    maintenanceCosts: [], operationCosts: [], demolishCost: 0, salvageValue: 0
                }]);
            };

            const removeOption = (id) => setOptions(options.filter(o => o.id !== id));
            const updateOption = (id, data) => setOptions(options.map(o => o.id === id ? { ...o, ...data } : o));
            const updateConfig = (data) => setConfig({ ...config, ...data });
            const updateProjectInfo = (data) => setProjectInfo({ ...projectInfo, ...data });
            const runAnalysis = () => setResults(analyzeAll(options, config));

            useEffect(() => { if (results.length > 0) runAnalysis(); }, [options, config]);

            return (
                <LCCContext.Provider value={{ options, config, projectInfo, results, addOption, removeOption, updateOption, updateConfig, updateProjectInfo, runAnalysis }}>
                    {children}
                </LCCContext.Provider>
            );
        };
        const useLCC = () => useContext(LCCContext);

        // -------------------------------------------------------------
        // ERROR BOUNDARY
        // -------------------------------------------------------------
        class ErrorBoundary extends React.Component {
            constructor(props) { super(props); this.state = { hasError: false, error: null }; }
            static getDerivedStateFromError(error) { return { hasError: true, error }; }
            render() {
                if (this.state.hasError) {
                    return (
                        <div className="p-8 bg-red-50 border border-red-200 rounded-lg text-red-800 max-w-2xl mx-auto mt-12">
                            <h2 className="text-2xl font-bold mb-4">Something went wrong</h2>
                            <p className="mb-4">The application encountered an error. Please report this to the developer.</p>
                            <pre className="bg-white p-4 rounded border border-red-100 overflow-auto text-xs">{this.state.error?.toString()}</pre>
                            <button onClick={() => window.location.reload()} className="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Reload Page</button>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // -------------------------------------------------------------
        // UI COMPONENTS
        // -------------------------------------------------------------
        const Button = ({ className, variant = 'primary', size = 'md', children, ...props }) => {
            const variants = {
                primary: 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg shadow-blue-500/30 hover:shadow-blue-500/40 hover:-translate-y-0.5 active:translate-y-0',
                secondary: 'bg-white text-gray-700 border border-gray-200 hover:bg-gray-50 hover:border-gray-300 shadow-sm',
                danger: 'bg-gradient-to-r from-red-500 to-rose-600 text-white shadow-lg shadow-red-500/30 hover:shadow-red-500/40 hover:-translate-y-0.5',
                ghost: 'bg-transparent text-gray-600 hover:bg-gray-100/50 hover:text-gray-900',
            };
            const sizes = { sm: 'h-8 px-3 text-sm', md: 'h-10 px-4 py-2', lg: 'h-12 px-6 text-lg' };
            return (
                <button className={cn('inline-flex items-center justify-center rounded-xl font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed', variants[variant], sizes[size], className)} {...props}>
                    {children}
                </button>
            );
        };

        const Input = ({ className, label, error, id, ...props }) => (
            <div className="w-full">
                {label && <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>}
                <input className={cn("flex h-10 w-full rounded-xl border border-gray-200 bg-white/50 px-3 py-2 text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all shadow-sm", error && "border-red-500 focus:ring-red-500/20", className)} {...props} />
            </div>
        );

        const Card = ({ className, children }) => <div className={cn("glass-panel rounded-2xl shadow-xl shadow-gray-200/40", className)}>{children}</div>;
        const CardHeader = ({ className, children }) => <div className={cn("p-6 pb-2", className)}>{children}</div>;
        const CardContent = ({ className, children }) => <div className={cn("p-6 pt-2", className)}>{children}</div>;

        const DynamicCostList = ({ title, items, onChange }) => {
            const addItem = () => onChange([...items, { id: Math.random().toString(36).substr(2, 9), name: `New Item`, value: 0, frequency: 'yearly' }]);
            const updateItem = (id, updates) => onChange(items.map(i => i.id === id ? { ...i, ...updates } : i));
            const removeItem = (id) => onChange(items.filter(i => i.id !== id));

            return (
                <div className="space-y-3">
                    <div className="flex justify-between items-center">
                        <h4 className="text-xs font-bold text-gray-500 uppercase tracking-wider">{title}</h4>
                        <Button size="sm" variant="ghost" onClick={addItem} className="text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50"><Icons.Plus className="h-4 w-4 mr-1" /> Add</Button>
                    </div>
                    {items.map(item => (
                        <div key={item.id} className="bg-white/40 p-3 rounded-xl border border-gray-100/50 space-y-3 shadow-sm hover:shadow-md transition-shadow">
                            <div className="flex justify-between gap-2">
                                <Input value={item.name} className="font-medium bg-transparent border-transparent focus:bg-white focus:border-indigo-200" onChange={e => updateItem(item.id, { name: e.target.value })} />
                                <Button size="sm" variant="ghost" onClick={() => removeItem(item.id)} className="text-gray-400 hover:text-red-500"><Icons.Trash2 className="h-4 w-4" /></Button>
                            </div>
                            <div className="grid grid-cols-2 gap-2">
                                <Input type="number" value={item.value} onChange={e => updateItem(item.id, { value: parseFloat(e.target.value) || 0 })} placeholder="0.00" />
                                <select className="h-10 rounded-xl border border-gray-200 bg-white/50 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20" value={item.frequency} onChange={e => updateItem(item.id, { frequency: e.target.value })}>
                                    <option value="yearly">Yearly</option>
                                    <option value="one-time">One-time</option>
                                    <option value="every-n-years">Every N Years</option>
                                </select>
                            </div>
                            {item.frequency === 'one-time' && <div className="flex gap-2 text-sm items-center text-gray-600">Year: <Input type="number" className="h-8 w-20" value={item.year || 1} onChange={e => updateItem(item.id, { year: parseInt(e.target.value) })} /></div>}
                            {item.frequency === 'every-n-years' && <div className="flex gap-2 text-sm items-center text-gray-600">Every: <Input type="number" className="h-8 w-20" value={item.interval || 5} onChange={e => updateItem(item.id, { interval: parseInt(e.target.value) })} /> Years</div>}
                        </div>
                    ))}
                </div>
            );
        };

        const OptionCard = ({ option }) => {
            const { updateOption, removeOption, options } = useLCC();
            return (
                <Card className="min-w-[360px] w-[360px] shrink-0 flex flex-col h-full border-t-[6px] border-t-indigo-500/80">
                    <CardHeader className="flex justify-between items-center bg-gradient-to-b from-white to-gray-50/20 border-b border-gray-100/50">
                        <Input className="font-bold text-lg border-transparent bg-transparent shadow-none focus:bg-white focus:shadow-sm px-0" value={option.name} onChange={e => updateOption(option.id, { name: e.target.value })} />
                        {options.length > 1 && <Button variant="ghost" size="sm" onClick={() => removeOption(option.id)} className="opacity-50 hover:opacity-100"><Icons.Trash2 className="h-4 w-4 text-gray-500 hover:text-red-600 top-0" /></Button>}
                    </CardHeader>
                    <CardContent className="space-y-6 overflow-y-auto max-h-[600px] flex-1 bg-white/30">
                        <textarea
                            className="w-full rounded-xl border border-gray-200/60 bg-white/40 px-3 py-2 text-sm text-gray-600 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/20 resize-none h-16 min-h-[4rem]"
                            placeholder="Option description (e.g. specs, warranty)..."
                            value={option.description || ''}
                            onChange={e => updateOption(option.id, { description: e.target.value })}
                        />
                        <div className="space-y-3 p-4 bg-blue-50/30 rounded-2xl border border-blue-100/50 backdrop-blur-sm">
                            <h4 className="text-xs font-bold text-blue-800 uppercase tracking-wider">1. Initial Investment</h4>
                            <Input label="Total Initial Cost" type="number" value={option.initialCost} onChange={e => updateOption(option.id, { initialCost: parseFloat(e.target.value) || 0 })} />
                        </div>
                        <DynamicCostList title="2. Maintenance" items={option.maintenanceCosts} onChange={i => updateOption(option.id, { maintenanceCosts: i })} />
                        <DynamicCostList title="3. Operation" items={option.operationCosts} onChange={i => updateOption(option.id, { operationCosts: i })} />
                        <div className="space-y-3 p-4 bg-orange-50/30 rounded-2xl border border-orange-100/50 backdrop-blur-sm">
                            <h4 className="text-xs font-bold text-orange-800 uppercase tracking-wider">4. End of Life</h4>
                            <Input label="Demolish Cost (+)" type="number" value={option.demolishCost} onChange={e => updateOption(option.id, { demolishCost: parseFloat(e.target.value) || 0 })} />
                            <Input label="Salvage Value (-)" type="number" value={option.salvageValue} onChange={e => updateOption(option.id, { salvageValue: parseFloat(e.target.value) || 0 })} />
                        </div>
                    </CardContent>
                </Card>
            );
        };

        const ProjectInfoPanel = () => {
            const { projectInfo, updateProjectInfo } = useLCC();
            return (
                <div className="glass-panel p-6 rounded-2xl shadow-lg mb-8 border border-white/60">
                    <div className="flex items-start gap-4">
                        <div className="p-3 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl text-white shadow-lg shadow-blue-500/20">
                            <Icons.FileText className="h-6 w-6" />
                        </div>
                        <div className="flex-1 space-y-4">
                            <div>
                                <h3 className="text-sm font-bold text-blue-900 uppercase tracking-wide mb-1">Project Information</h3>
                                <input
                                    className="w-full text-3xl font-bold bg-transparent border-none focus:ring-0 text-gray-800 placeholder:text-gray-300 px-0 -ml-1"
                                    placeholder="Project Name..."
                                    value={projectInfo.name}
                                    onChange={e => updateProjectInfo({ name: e.target.value })}
                                />
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="space-y-2">
                                    <label className="text-xs font-semibold text-gray-500 uppercase">Description / Subject</label>
                                    <textarea
                                        className="w-full rounded-xl border border-gray-200 bg-white/50 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 resize-none h-20"
                                        placeholder="Brief description of the analysis..."
                                        value={projectInfo.description}
                                        onChange={e => updateProjectInfo({ description: e.target.value })}
                                    />
                                </div>
                                <div className="space-y-4">
                                    <Input
                                        label="Analyst / Author"
                                        value={projectInfo.analyst}
                                        onChange={e => updateProjectInfo({ analyst: e.target.value })}
                                        placeholder="Enter your name"
                                    />
                                    <Input
                                        label="Date"
                                        type="date"
                                        value={projectInfo.date}
                                        onChange={e => updateProjectInfo({ date: e.target.value })}
                                    />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const GlobalConfigPanel = () => {
            const { config, updateConfig } = useLCC();
            return (
                <Card className="mb-8 border-l-[6px] border-l-violet-600 bg-gradient-to-r from-violet-50/50 to-white/60">
                    <CardHeader className="flex gap-3 items-center border-b border-violet-100/50 pb-4">
                        <div className="p-2 bg-violet-100 rounded-lg text-violet-600"><Icons.Settings className="h-5 w-5" /></div>
                        <h2 className="text-xl font-bold text-gray-800">Global Configuration</h2>
                    </CardHeader>
                    <CardContent className="grid grid-cols-1 md:grid-cols-3 gap-8 p-8">
                        <Input label="Project Lifespan (Years)" type="number" min="1" value={config.lifespan} onChange={e => updateConfig({ lifespan: Math.max(1, parseInt(e.target.value) || 1) })} className="text-lg font-medium text-violet-900" />
                        <Input label="Inflation Rate (%)" type="number" step="0.1" value={config.inflationRate} onChange={e => updateConfig({ inflationRate: parseFloat(e.target.value) || 0 })} className="text-lg font-medium text-violet-900" />
                        <Input label="Discount Rate (%)" type="number" step="0.1" value={config.discountRate} onChange={e => updateConfig({ discountRate: parseFloat(e.target.value) || 0 })} className="text-lg font-medium text-violet-900" />
                    </CardContent>
                </Card>
            );
        };

        // SAFETY CHECK FOR RECHARTS
        const RechartsLib = window.Recharts || window.Recharts?.default || {};
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, LineChart, Line } = RechartsLib;
        const ChartsAvailable = !!(BarChart && LineChart);

        if (!ChartsAvailable) {
            console.error("Recharts library failed to load or is missing components.", { RechartsLib });
        }

        // Modern 2025 Palette
        const COLORS = [
            '#8b5cf6', // Violet
            '#10b981', // Emerald
            '#f59e0b', // Amber
            '#ec4899', // Pink
            '#06b6d4', // Cyan
            '#f43f5e'  // Rose
        ];

        const AnalysisDashboard = () => {
            const { results, runAnalysis, options, config } = useLCC();

            const GlossarySection = () => (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8 animate-in fade-in slide-in-from-bottom-8 duration-700 delay-100">
                    <div className="bg-white/60 p-6 rounded-2xl border border-indigo-100 shadow-sm backdrop-blur-sm">
                        <h4 className="font-bold text-indigo-900 mb-3 flex items-center gap-2">
                            <div className="p-1.5 bg-indigo-100 rounded-lg"><Icons.Info className="h-4 w-4 text-indigo-600" /></div> Key Metrics
                        </h4>
                        <ul className="space-y-3 text-sm text-gray-600">
                            <li className="flex gap-2"><span className="font-bold text-indigo-700 whitespace-nowrap">NPV (Net Present Value):</span> <span>The total value of all future cash flows (costs) discounted to today's value. Lower is better.</span></li>
                            <li className="flex gap-2"><span className="font-bold text-indigo-700 whitespace-nowrap">EAC (Equivalent Annual Cost):</span> <span>The annualized cost of owning and operating the asset over its lifespan. Useful for comparing options with different lifespans.</span></li>
                        </ul>
                    </div>
                    <div className="bg-white/60 p-6 rounded-2xl border border-violet-100 shadow-sm backdrop-blur-sm">
                        <h4 className="font-bold text-violet-900 mb-3 flex items-center gap-2">
                            <div className="p-1.5 bg-violet-100 rounded-lg"><Icons.Settings className="h-4 w-4 text-violet-600" /></div> Parameters
                        </h4>
                        <ul className="space-y-3 text-sm text-gray-600">
                            <li className="flex gap-2"><span className="font-bold text-violet-700 whitespace-nowrap">LCC (Life Cycle Cost):</span> <span>The total cost of ownership, including initial investment, operation, maintenance, and disposal costs, minus any residual value.</span></li>
                            <li className="flex gap-2"><span className="font-bold text-violet-700 whitespace-nowrap">Discount Rate:</span> <span>The interest rate used to convert future costs into present value, reflecting the time value of money.</span></li>
                        </ul>
                    </div>
                </div>
            );

            if (!results.length) return (
                <div className="flex flex-col items-center justify-center p-16 bg-white/50 backdrop-blur-sm rounded-3xl border border-dashed border-indigo-200 text-center animate-in fade-in zoom-in-95 duration-500">
                    <div className="bg-indigo-100 p-4 rounded-full mb-6">
                        <Icons.Trophy className="h-8 w-8 text-indigo-600" />
                    </div>
                    <h3 className="text-xl font-bold text-gray-800 mb-2">Ready to Analyze?</h3>
                    <p className="mb-8 text-gray-500 max-w-md">Input your cost data above and let our advanced algorithm calculate the most cost-effective solution for you.</p>
                    <Button size="lg" onClick={runAnalysis} className="shadow-xl shadow-indigo-500/30"><Icons.Play className="h-5 w-5 mr-2" /> Start Analysis</Button>
                </div>
            );

            const barData = results.map((res, i) => ({ name: options.find(o => o.id === res.optionId)?.name || res.optionId, NPV: Math.round(res.totalNPV), color: COLORS[i % COLORS.length] }));

            const lineData = [];
            const yearlyCashFlowData = [];
            for (let y = 0; y <= config.lifespan; y++) {
                const ptLine = { year: y };
                const ptBar = { year: y };
                results.forEach(res => {
                    const flow = res.cashFlows.find(f => f.year === y);
                    ptLine[res.optionId] = flow ? Math.round(flow.cumulativeNPV) : 0;
                    ptBar[res.optionId] = flow ? Math.round(flow.cost) : 0;
                });
                lineData.push(ptLine);
                yearlyCashFlowData.push(ptBar);
            }

            const sorted = [...results].sort((a, b) => a.totalNPV - b.totalNPV);
            const bestId = sorted[0]?.optionId;
            const fmt = (v) => new Intl.NumberFormat('en-US').format(v);

            const bestOption = options.find(o => o.id === bestId);
            const bestResult = results.find(r => r.optionId === bestId);

            return (
                <div className="space-y-8 animate-in fade-in slide-in-from-bottom-6 duration-700">
                    <div className="flex flex-col md:flex-row justify-between items-end gap-4">
                        <div>
                            <h2 className="text-3xl font-bold tracking-tight text-gray-900">Analysis Results</h2>
                            <p className="text-gray-500 mt-1 flex items-center gap-2">Projection over <span className="font-semibold text-gray-900">{config.lifespan} years</span></p>
                        </div>
                        <Button variant="secondary" onClick={runAnalysis} className="bg-white text-gray-700 border-gray-200 hover:bg-gray-50 hover:border-gray-300 shadow-sm">
                            Refresh Analysis
                        </Button>
                    </div>

                    {/* Winner Banner */}
                    <div className="relative overflow-hidden rounded-3xl bg-gradient-to-br from-emerald-500 to-teal-600 text-white shadow-2xl shadow-emerald-900/20 p-8 border border-white/10">
                        <div className="absolute top-0 right-0 -mt-8 -mr-8 w-64 h-64 bg-white/10 rounded-full blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -mb-8 -ml-8 w-40 h-40 bg-black/5 rounded-full blur-2xl"></div>
                        <div className="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8">
                            <div className="flex items-center gap-6">
                                <div className="p-4 bg-white/20 rounded-2xl backdrop-blur-md shadow-inner border border-white/20">
                                    <Icons.Trophy className="h-10 w-10 text-white" />
                                </div>
                                <div>
                                    <div className="flex items-center gap-3 mb-1">
                                        <span className="px-3 py-1 rounded-full bg-emerald-400/30 border border-emerald-300/30 text-emerald-50 text-xs font-bold uppercase tracking-wider backdrop-blur-md">Recommended Option</span>
                                    </div>
                                    <h3 className="text-3xl font-bold text-white tracking-tight">{bestOption?.name}</h3>
                                    <p className="text-emerald-100 mt-1 font-medium">Lowest Total Cost of Ownership</p>
                                </div>
                            </div>
                            <div className="text-center md:text-right bg-white/10 p-4 rounded-2xl border border-white/10 backdrop-blur-sm">
                                <p className="text-emerald-100 text-sm font-medium uppercase tracking-wider mb-1">Total NPV</p>
                                <div className="text-4xl font-black text-white tracking-tight">{fmt(bestResult?.totalNPV)}</div>
                                <p className="text-xs text-emerald-200 mt-1">Saves {fmt(sorted[1] ? sorted[1].totalNPV - bestResult.totalNPV : 0)} vs next best</p>
                            </div>
                        </div>
                    </div>
                    {ChartsAvailable ? (
                        <div className="space-y-8">
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <Card>
                                    <CardHeader><h3 className="font-bold text-gray-700">Total Cost (NPV) Comparison</h3></CardHeader>
                                    <CardContent className="h-[350px]">
                                        <ResponsiveContainer><BarChart data={barData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}><CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" /><XAxis dataKey="name" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} dy={10} /><YAxis axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} /><Tooltip cursor={{ fill: 'transparent' }} contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)' }} /><Legend wrapperStyle={{ paddingTop: '20px' }} /><Bar dataKey="NPV" radius={[8, 8, 0, 0]}>{barData.map((e, i) => <RechartsLib.Cell key={i} fill={e.color} />)}</Bar></BarChart></ResponsiveContainer>
                                    </CardContent>
                                </Card>
                                <Card>
                                    <CardHeader><h3 className="font-bold text-gray-700">Cumulative Cost Over Time</h3></CardHeader>
                                    <CardContent className="h-[350px]">
                                        <ResponsiveContainer><LineChart data={lineData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}><CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" /><XAxis dataKey="year" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} dy={10} /><YAxis axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} /><Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)' }} /><Legend wrapperStyle={{ paddingTop: '20px' }} />{results.map((res, i) => <Line key={res.optionId} type="monotone" dataKey={res.optionId} stroke={COLORS[i % COLORS.length]} strokeWidth={3} dot={{ r: 4, strokeWidth: 2 }} activeDot={{ r: 6 }} />)}</LineChart></ResponsiveContainer>
                                    </CardContent>
                                </Card>
                            </div>
                            <Card>
                                <CardHeader><h3 className="font-bold text-gray-700">Yearly Investment Overview (Cash Flow)</h3></CardHeader>
                                <CardContent className="h-[350px]">
                                    <ResponsiveContainer><BarChart data={yearlyCashFlowData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}><CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#e2e8f0" /><XAxis dataKey="year" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} dy={10} /><YAxis axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 12 }} /><Tooltip cursor={{ fill: 'rgba(0,0,0,0.05)' }} contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)' }} /><Legend wrapperStyle={{ paddingTop: '20px' }} />{results.map((res, i) => <Bar key={res.optionId} dataKey={res.optionId} fill={COLORS[i % COLORS.length]} radius={[4, 4, 0, 0]} />)}</BarChart></ResponsiveContainer>
                                </CardContent>
                            </Card>
                        </div>
                    ) : (
                        <div className="p-4 bg-yellow-100 text-yellow-800 rounded-md">Charts could not be loaded (Recharts library missing). Breakdown available below.</div>
                    )}

                    <Card><CardHeader><h3 className="font-bold text-gray-700">Detailed Breakdown</h3></CardHeader>
                        <CardContent className="overflow-x-auto p-0">
                            <table className="min-w-full text-sm">
                                <thead className="bg-gray-50/80 backdrop-blur-sm sticky top-0">
                                    <tr>
                                        <th className="px-6 py-4 text-left font-semibold text-gray-500">Metric</th>
                                        {results.map(res => (
                                            <th key={res.optionId} className={cn("px-6 py-4 text-right font-bold transition-colors duration-300",
                                                res.optionId === bestId ? "text-emerald-700 bg-emerald-50/50" : "text-gray-700"
                                            )}>
                                                {options.find(o => o.id === res.optionId)?.name}
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-100">
                                    <tr>
                                        <td className="px-6 py-4 text-gray-600">Initial Cost</td>
                                        {results.map(res => <td key={res.optionId} className={cn("px-6 py-4 text-right font-medium", res.optionId === bestId ? "bg-emerald-50/30 text-gray-900" : "text-gray-700")}>{fmt(options.find(o => o.id === res.optionId)?.initialCost)}</td>)}
                                    </tr>
                                    <tr className="bg-white">
                                        <td className="px-6 py-4 font-bold text-indigo-900">Total NPV</td>
                                        {results.map(res => <td key={res.optionId} className={cn("px-6 py-4 text-right font-bold border-t border-b border-transparent", res.optionId === bestId ? "bg-emerald-100/50 text-emerald-800 border-emerald-200" : "text-indigo-900")}>{fmt(res.totalNPV)}</td>)}
                                    </tr>
                                    <tr>
                                        <td className="px-6 py-4 text-violet-600 font-medium">Annualized Cost (EAC)</td>
                                        {results.map(res => <td key={res.optionId} className={cn("px-6 py-4 text-right font-medium", res.optionId === bestId ? "bg-emerald-50/30 text-emerald-700" : "text-violet-600")}>{fmt(res.eac)}</td>)}
                                    </tr>
                                </tbody>
                            </table>
                        </CardContent>
                    </Card>
                    <GlossarySection />
                </div>
            );
        };

        const App = () => (
            <ErrorBoundary>
                <LCCProvider>
                    <div className="min-h-screen font-sans text-gray-900 pb-12">
                        <header className="glass-header sticky top-0 z-30"><div className="max-w-7xl mx-auto px-6 py-4 flex items-center gap-3 font-bold text-xl text-gray-800"><div className="bg-gradient-to-br from-indigo-500 to-violet-600 p-2 rounded-xl text-white shadow-lg shadow-indigo-500/30"><Icons.Settings className="h-6 w-6" /></div><span className="bg-clip-text text-transparent bg-gradient-to-r from-gray-900 to-gray-600">LCC Decision System</span></div></header>
                        <main className="max-w-7xl mx-auto px-6 py-10 space-y-12">
                            <ProjectInfoPanel />
                            <GlobalConfigPanel />
                            <LCCContext.Consumer>
                                {({ options, addOption }) => (
                                    <section className="space-y-6">
                                        <div className="flex justify-between items-center"><h2 className="text-2xl font-bold text-gray-800">Investment Options</h2><Button onClick={addOption} className="bg-gray-900 text-white hover:bg-gray-800"><Icons.Plus className="h-4 w-4 mr-2" /> New Option</Button></div>
                                        <div className="flex gap-8 overflow-x-auto pb-8 -mx-6 px-6 scrollbar-hide"><div className="flex gap-8">{options.map(o => <OptionCard key={o.id} option={o} />)}</div></div>
                                    </section>
                                )}
                            </LCCContext.Consumer>
                            <section className="pt-8 border-t border-gray-200/60"><AnalysisDashboard /></section>
                        </main>
                    </div>
                </LCCProvider>
            </ErrorBoundary>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>